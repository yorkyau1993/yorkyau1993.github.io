<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <title>7æ—¥å¤©æ°£ç¨ç«‹ç·¨è¼¯å™¨ - æ¥µç°¡ç„¡æ¨™é»ç‰ˆ</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; background: #1a1a1a; color: white; padding: 20px; margin: 0; display: flex; flex-direction: column; align-items: center; }
        .global-controls { 
            background: #333; padding: 15px 30px; border-radius: 50px; 
            margin-bottom: 30px; position: sticky; top: 10px; z-index: 1000;
            display: flex; gap: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); align-items: center;
        }
        label { font-size: 12px; color: #aaa; font-weight: bold; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 20px; width: 100%; max-width: 1400px; }
        .card { background: #262626; padding: 15px; border-radius: 20px; display: flex; flex-direction: column; border: 1px solid #333; }
        canvas { 
            width: 100%; height: auto; border-radius: 10px; cursor: move; touch-action: none;
            background-image: linear-gradient(45deg, #333 25%, transparent 25%), linear-gradient(-45deg, #333 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #333 75%), linear-gradient(-45deg, transparent 75%, #333 75%);
            background-size: 20px 20px; border: 1px solid #444; margin-bottom: 10px;
        }
        input[type="text"], textarea { 
            background: #111; color: white; border: 1px solid #444; padding: 8px; 
            margin-top: 5px; border-radius: 5px; width: 100%; box-sizing: border-box; font-family: inherit; font-weight: bold;
        }
        textarea { height: 60px; resize: none; }
        .btn-group { display: flex; gap: 10px; margin-top: 10px; }
        button { flex: 1; padding: 10px; border-radius: 5px; border: none; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .dl-btn { background: #444; color: white; }
        .pp-btn { background: #18d363; color: black; }
        button:hover { opacity: 0.8; transform: translateY(-2px); }
    </style>
</head>
<body>

    <div class="global-controls">
        <div><label>ğŸŒ“ é™°å½±</label><input type="range" id="gShadow" min="0" max="60" value="30" oninput="drawAll()"></div>
        <div><label>ğŸ–‹ï¸ å¤–æ¡†</label><input type="range" id="gStroke" min="0" max="20" value="8" oninput="drawAll()"></div>
        <div style="font-size: 12px; color: #0084ff;">â— ç¨ç«‹æ‹–æ‹½æ–‡å­— â— æ¯ä¸€æ ¼é…å‚™ Photopea</div>
    </div>

    <div id="weatherGrid" class="grid">æ­£åœ¨æŠ“å–å¤©æ–‡å°æ•¸æ“š...</div>

    <script>
        const HKO_API = 'https://data.weather.gov.hk/weatherAPI/opendata/weather.php?dataType=fnd&lang=tc';
        let items = [];

        async function init() {
            try {
                const res = await fetch(HKO_API);
                const data = await res.json();
                const forecast = data.weatherForecast.slice(0, 7);
                
                forecast.forEach((day, i) => {
                    const minT = typeof day.forecastMintemp === 'object' ? day.forecastMintemp.value : day.forecastMintemp;
                    const maxT = typeof day.forecastMaxtemp === 'object' ? day.forecastMaxtemp.value : day.forecastMaxtemp;
                    
                    // ç§»é™¤æ¨™é»èˆ‡æ‹¬è™Ÿçš„é‚è¼¯
                    const cleanWeather = day.forecastWeather.replace(/[ï¼Œã€‚ã€ï¼ˆï¼‰()]/g, ' ').trim();

                    items.push({
                        date: { text: `${day.forecastDate.substring(4,6)}æœˆ${day.forecastDate.substring(6,8)}æ—¥ ${day.week}`, x: 80, y: 700, w: 450, h: 80 },
                        temp: { text: `${minT} ${maxT} C`, x: 80, y: 880, w: 600, h: 180 },
                        desc: { text: cleanWeather, x: 80, y: 980, w: 800, h: 120 },
                        dragging: null,
                        offset: { x: 0, y: 0 }
                    });
                });
                renderUI();
            } catch (e) { alert("æ•¸æ“šè¼‰å…¥å¤±æ•—"); }
        }

        function renderUI() {
            const grid = document.getElementById('weatherGrid');
            grid.innerHTML = '';
            items.forEach((item, i) => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <canvas id="cvs-${i}" width="1080" height="1080"></canvas>
                    <input type="text" value="${item.date.text}" oninput="items[${i}].date.text=this.value; draw(${i})">
                    <input type="text" value="${item.temp.text}" style="color:#ffde06" oninput="items[${i}].temp.text=this.value; draw(${i})">
                    <textarea oninput="items
